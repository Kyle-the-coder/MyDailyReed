import{a as _,r as i,j as e,f as E}from"./index-BeP9_3gn.js";import{t as F,B as ee,x as te}from"./firebase-DohhskBT.js";import{m as ae,d as se,r as le,a as re,i as ie,u as k}from"./shuffle-k8Xc0Vt1.js";import{P as ne}from"./PostLoader-C2TeVUX7.js";import{d as D}from"./x-button-DkK3Y9wF.js";import{T as oe}from"./TiptapEditor-BGtmyzFo.js";import{s as ce}from"./check-DPRlVH8d.js";import"./react-DJG_os-6.js";import"./gsap-Brfk6Bdo.js";function ye(){const{id:g}=_(),[h,v]=i.useState(null),[M,z]=i.useState({}),[O,u]=i.useState(!1),[y,j]=i.useState(!1),[m,p]=i.useState([]),[b,N]=i.useState(""),[C,R]=i.useState(""),[U,w]=i.useState(""),[f,S]=i.useState([]),[x,P]=i.useState([]),[I,T]=i.useState(""),[A,L]=i.useState(""),[W,q]=i.useState(null),$=[{img:se,type:"Description",label:"Description"},{img:le,type:"Redirect",label:"Redirect Link"},{img:re,type:"Article",label:"Article Content"},{img:ie,type:"Image",label:"Image Upload"}];i.useEffect(()=>{(async()=>{u(!0);try{const a=F(E,"blogs",g),r=await ee(a);if(r.exists()){const s=r.data(),n=Array.isArray(s.content)?s.content.map(l=>typeof l.value=="string"||l.type==="Redirect"&&typeof l.value=="object"&&l.value!==null?l:{...l,value:l.type==="Redirect"?{partName:"",partUrl:""}:""}):[];N(s.title||""),T(s.subTitle||""),R(s.author||""),w(s.readTime||""),L(s.part||""),P(s.categories||[]),q(s.imgUrl||null),p(n),v(s.imgUrl||null)}else console.error("No such document!")}catch(a){console.error("Error fetching blog:",a)}u(!1)})()},[g]);const G=t=>{p(t==="Redirect"?a=>[...a,{type:t,value:{partName:"",partUrl:""}}]:a=>[...a,{type:t,value:""}]),j(!1)},B=t=>{S(a=>a.filter(r=>r!==t)),P(a=>a.filter(r=>r!==t))},d=(t,a,r=null)=>{const s=[...m];if(r&&typeof s[t].value=="object"?s[t].value={...s[t].value,[r]:a}:s[t].value=a,p(s),s[t].type==="Image"&&a instanceof File){const n=URL.createObjectURL(a);z(l=>({...l,[t]:n}))}},H=(t,a)=>{var r,s;switch(t.type){case"Description":case"Article":return e.jsxs("div",{style:{marginBottom:"100px"},className:"display-column",children:[e.jsx("label",{className:"input-label outfit-font",style:{fontSize:"1.5rem"},children:t.type}),e.jsx(oe,{content:t.value,onChange:l=>d(a,l)})]},a);case"Redirect":return e.jsxs("div",{className:"display-column",style:{marginBottom:"100px",padding:"30px 3%"},children:[e.jsx("label",{className:"input-label outfit-font",children:"Redirect Name"}),e.jsx("input",{className:"input",type:"text",value:((r=t.value)==null?void 0:r.partName)||"",onChange:l=>d(a,l.target.value,"partName"),placeholder:"Part 3, or Part 1",style:{marginBottom:"30px",padding:"10px 20px"}}),e.jsx("label",{className:"input-label outfit-font",children:"Redirect Url"}),e.jsx("input",{className:"input",type:"url",value:((s=t.value)==null?void 0:s.partUrl)||"",onChange:l=>d(a,l.target.value,"partUrl"),style:{padding:"10px 20px"}})]},a);case"Image":const n=M[a]||(typeof t.value=="string"?t.value:null);return e.jsxs("div",{className:"display-column",style:{marginBottom:"100px"},children:[e.jsx("label",{className:"input-label outfit-font",children:"Upload Image"}),e.jsx("input",{className:"input-file",type:"file",accept:"image/*",onChange:l=>d(a,l.target.files[0])}),n&&e.jsx("img",{src:n,alt:"Preview",style:{maxWidth:"200px",marginTop:"10px",borderRadius:"8px"}})]},a);default:return null}},J=async t=>{var a,r;t.preventDefault(),u(!0);try{const s=document.querySelector('input[type="file"]');let n=W;s!=null&&s.files[0]&&(n=await k(s.files[0]));const l=await Promise.all(m.map(async o=>{if(o.type==="Image"&&o.value instanceof File){const Z=await k(o.value);return{...o,value:Z}}return o})),c=m.find(o=>o.type==="Redirect"),K=((a=c==null?void 0:c.value)==null?void 0:a.partName)||null,Q=((r=c==null?void 0:c.value)==null?void 0:r.partUrl)||null,V=Array.from(new Set([...x||[],...f||[]])),X={title:b,subTitle:I,author:C,readTime:U,part:A,imgUrl:n,content:l,categories:V,partName:K,partUrl:Q},Y=F(E,"blogs",g);await te(Y,X),alert("Blog updated successfully!")}catch(s){console.error("Error updating blog:",s),alert("Failed to update blog")}finally{u(!1)}};return e.jsxs("section",{className:"create-blog-main",children:[e.jsx("h1",{className:"outfit-font",children:"Edit Blog"}),e.jsx("div",{className:"display-column",children:e.jsxs("form",{className:"form",children:[e.jsxs("div",{className:"input-container",children:[e.jsx("label",{className:"input-label outfit-font",children:"Title:"}),e.jsx("input",{className:"input playfair-font",type:"text",value:b,onChange:t=>N(t.target.value)})]}),e.jsxs("div",{className:"input-container",children:[e.jsx("label",{className:"input-label outfit-font",children:"Category Title (optional):"}),e.jsx("input",{className:"input playfair-font",type:"text",value:I,onChange:t=>T(t.target.value)})]}),e.jsxs("div",{className:"input-container",children:[e.jsx("label",{className:"input-label outfit-font",children:"Part Number (optional):"}),e.jsx("input",{className:"input-part",type:"number",value:A,onChange:t=>L(t.target.value)})]}),e.jsxs("div",{className:"input-container",children:[e.jsx("label",{className:"input-label outfit-font",children:"Author:"}),e.jsx("input",{className:"input playfair-font",type:"text",value:C,onChange:t=>R(t.target.value)})]}),e.jsxs("div",{className:"input-container",children:[e.jsx("label",{className:"input-label outfit-font",children:"Read Time:"}),e.jsx("input",{className:"input playfair-font",type:"text",value:U,onChange:t=>w(t.target.value)})]}),e.jsxs("div",{className:"input-container",children:[e.jsx("label",{className:"input-label outfit-font",children:"Categories:"}),e.jsx("input",{className:"input playfair-font",type:"text",onChange:t=>S(t.target.value.split(",").map(a=>a.trim()).filter(a=>a!==""))}),x.length>0&&e.jsxs("div",{className:"category-container outfit-font",children:[e.jsx("h1",{className:"outfit-font",children:"Categories:"}),x.map(t=>e.jsxs("div",{className:"edit-cat1 silver-bg",children:[t,e.jsx("img",{src:D,className:"del-button",onClick:()=>B(t)})]},t)),f.length>0&&e.jsx(e.Fragment,{children:f.map(t=>e.jsxs("div",{className:"edit-cat1 outfit-font silver-bg",children:[t,e.jsx("img",{src:D,className:"del-button",onClick:()=>B(t)})]},t))})]})]}),e.jsxs("div",{className:"input-container",children:[e.jsx("label",{className:"input-label outfit-font",children:"Photo:"}),e.jsx("input",{className:"input-file",type:"file",accept:"image/*",onChange:t=>{const a=t.target.files[0];a&&v(URL.createObjectURL(a))}}),h&&e.jsx("img",{src:h,alt:"Main preview",style:{maxWidth:"200px",marginTop:"10px",borderRadius:"8px"}})]}),e.jsxs("div",{className:"form-array-container",children:[m.map((t,a)=>H(t,a)),e.jsxs("div",{className:"add-to-array",children:[e.jsx("img",{className:"form-icon menu-icon off-white-bg",src:ae,onClick:()=>j(!y)}),O?e.jsx("div",{className:"post-loader-container",children:e.jsx(ne,{})}):e.jsx("img",{className:"form-icon submit-icon off-white-bg",src:ce,onClick:J}),e.jsx("div",{className:`expanded-icons ${y?"show":""}`,children:$.map((t,a)=>e.jsx("img",{src:t.img,title:t.label,className:"form-icon",onClick:()=>G(t.type)},a))})]})]})]})})]})}export{ye as default};
