import{r as u,u as j,j as l,W as _,f as b}from"./index-BH31ck8G.js";import{n as S,p as v}from"./firebase-DohhskBT.js";import{T}from"./TiptapEditor-DVhIeWi7.js";import{P as y}from"./PostLoader-DE8_Iuvt.js";import"./react-DJG_os-6.js";import"./gsap-Brfk6Bdo.js";const p={_origin:"https://api.emailjs.com"},N=(t,e="https://api.emailjs.com")=>{p._userID=t,p._origin=e},x=(t,e,i)=>{if(!t)throw"The user ID is required. Visit https://dashboard.emailjs.com/admin/integration";if(!e)throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!i)throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates";return!0};class g{constructor(e){this.status=e.status,this.text=e.responseText}}const E=(t,e,i={})=>new Promise((m,n)=>{const o=new XMLHttpRequest;o.addEventListener("load",({target:a})=>{const c=new g(a);c.status===200||c.text==="OK"?m(c):n(c)}),o.addEventListener("error",({target:a})=>{n(new g(a))}),o.open("POST",p._origin+t,!0),Object.keys(i).forEach(a=>{o.setRequestHeader(a,i[a])}),o.send(e)}),D=(t,e,i,m)=>{const n=m||p._userID;return x(n,t,e),E("/api/v1.0/email/send",JSON.stringify({lib_version:"3.2.0",user_id:n,service_id:t,template_id:e,template_params:i}),{"Content-type":"application/json"})},L=t=>{let e;if(typeof t=="string"?e=document.querySelector(t):e=t,!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of form";return e},C=(t,e,i,m)=>{const n=m||p._userID,o=L(i);x(n,t,e);const a=new FormData(o);return a.append("lib_version","3.2.0"),a.append("service_id",t),a.append("template_id",e),a.append("user_id",n),E("/api/v1.0/email/send-form",a)},k={init:N,send:D,sendForm:C},P="service_idgusqv",F="template_wnz2n4f",I="ol-G95eDhF-DHKWb0";function q(){const[t,e]=u.useState([]),[i,m]=u.useState(!0);return u.useEffect(()=>{(async()=>{const a=(await S(v(b,"newsletter"))).docs.map(c=>{const h=c.data();return h.email?{id:c.id,email:h.email}:null}).filter(Boolean);e(a),m(!1)})()},[]),{emails:t,loading:i}}function A(){const{emails:t,loading:e}=q(),[i,m]=u.useState(""),[n,o]=u.useState([]),[a,c]=u.useState(!1),h=j(),w=s=>{o(r=>r.includes(s)?r.filter(d=>d!==s):[...r,s])};u.useEffect(()=>{if(!e&&t.length>0){const s=t.map(r=>r.email);o(s)}},[e,t]);const f=async s=>{s.preventDefault(),c(!0);try{for(const r of n){const d={to_email:r,message:i};console.log("Sending to:",r,d),await k.send(P,F,d,I)}alert("Newsletter sent successfully!"),h("/dashboard"),window.scrollTo(0,0)}catch(r){console.error("EmailJS Error:",r),alert("Failed to send newsletter.")}finally{c(!1)}};return l.jsxs("form",{onSubmit:f,className:"newsletter-form",children:[l.jsx("h2",{className:"outfit-font",style:{fontSize:"2rem",marginBottom:"50px",color:"white"},children:"Send Newsletter"}),e?l.jsx("div",{className:"email-list",children:l.jsx(y,{})}):l.jsxs("div",{className:"email-list",children:[l.jsx("div",{className:"check-all-wrapper",children:l.jsx("button",{type:"button",onClick:()=>{const s=t.map(d=>d.email),r=s.every(d=>n.includes(d));o(r?[]:s)},className:"check-all-button",children:n.length===t.length?"Uncheck All":"Check All"})}),t.map(s=>l.jsxs("label",{className:"email-option outfit-font",children:[l.jsx("input",{type:"checkbox",checked:n.includes(s.email),onChange:()=>w(s.email)}),s.email]},s.id))]}),l.jsx(T,{content:"",onChange:m}),l.jsx("div",{className:"email-button",children:l.jsx(_,{text:"Send",disabled:a||!n.length,onClick:s=>f(s)})})]})}export{A as default,q as useNewsletterEmails};
